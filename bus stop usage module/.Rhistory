queries[length(queries)+1] <- query
}
}
}
hourly <- c(500,550,700,950,1000,1200,950,800,650,500,450,400,350,300,200,100)
queries <- list()
for (i in 7:23) {
if (nchar(as.character(i)) == 1) {
hour <- paste0("0",as.character(i-8))
} else {
hour <- as.character(i-8)
}
minutes <- c(round(rnorm(hourly[i-6], 5, 1.5)))
for (j in 1:60) {
for (k in 1:minutes[j]) {
query <- c(
paste0('{
"bus" : "A1",
"sourceBusStop" : "KentRidgeMRT",
"destinationBusStop" : "PGPR",
"timestamp" : {"$date": "',substring(as.character(Sys.time()), 0, 10),'T',hour,substring(as.character(Sys.time()), 14, 19), '.Z','"}
}')
)
queries[length(queries)+1] <- query
}
}
}
for (i in 7:23) {
if (nchar(as.character(i)) == 1) {
hour <- paste0("0",as.character(i-8))
} else {
hour <- as.character(i-8)
}
minutes <- c(round(rnorm(hourly[i-6], 5, 1.5)))
print(minutes)
for (j in 1:60) {
for (k in 1:minutes[j]) {
query <- c(
paste0('{
"bus" : "A1",
"sourceBusStop" : "KentRidgeMRT",
"destinationBusStop" : "PGPR",
"timestamp" : {"$date": "',substring(as.character(Sys.time()), 0, 10),'T',hour,substring(as.character(Sys.time()), 14, 19), '.Z','"}
}')
)
queries[length(queries)+1] <- query
}
}
}
hourly <- c(500,550,700,950,1000,1200,950,800,650,500,450,400,350,300,200,100)
queries <- list()
for (i in 7:23) {
if (nchar(as.character(i)) == 1) {
hour <- paste0("0",as.character(i-8))
} else {
hour <- as.character(i-8)
}
minutes <- c(round(rnorm(hourly[i-6], 5, 1.5)))
print(minutes)
for (j in 1:60) {
for (k in 1:minutes[j]) {
query <- c(
paste0('{
"bus" : "A1",
"sourceBusStop" : "KentRidgeMRT",
"destinationBusStop" : "PGPR",
"timestamp" : {"$date": "',substring(as.character(Sys.time()), 0, 10),'T',hour,substring(as.character(Sys.time()), 14, 19), '.772Z','"}
}')
)
queries[length(queries)+1] <- query
}
}
}
queries
time<-Sys.time()
time
queryList$insert(c(paste0('{"timestamp": {"$date":"', time,'"}}')))
time
substring(as.character(Sys.time()), 0, 19)
install.packages('lubridate')
library(lubridate)
time
hour(time)
hour(time) <- 7
time
minute(time)
queryList <- mongo(db = "local", collection = "queryList")
set.seed(123)
hourly <- c(500,550,700,950,1000,1200,950,800,650,500,450,400,350,300,200,100)
queries <- list()
for (i in 7:23) {
minutes <- c(round(rnorm(hourly[i-6], 5, 1.5)))
for (j in 1:60) {
for (k in 1:minutes[j]) {
time <- Sys.time()
hour(time) <- i
minute(time) <- j
query <- c(
paste0('{
"bus" : "A1",
"sourceBusStop" : "KentRidgeMRT",
"destinationBusStop" : "PGPR",
"timestamp" : {"$date": "',date,'"}}'
)
)
queries[length(queries)+1] <- query
}
}
}
for (i in 7:23) {
minutes <- c(round(rnorm(hourly[i-6], 5, 1.5)))
for (j in 1:60) {
for (k in 1:minutes[j]) {
date <- Sys.time()
hour(date) <- i
minute(date) <- j
query <- c(
paste0('{
"bus" : "A1",
"sourceBusStop" : "KentRidgeMRT",
"destinationBusStop" : "PGPR",
"timestamp" : {"$date": "',date,'"}}'
)
)
queries[length(queries)+1] <- query
}
}
}
library(mc2d)
library(lubridate)
queryList <- mongo(db = "local", collection = "queryList")
set.seed(123)
hourly <- c(500,550,700,950,1000,1200,950,800,650,500,450,400,350,300,200,100)
queries <- list()
for (i in 7:23) {
minutes <- c(round(rnorm(hourly[i-6], 5, 1.5)))
for (j in 1:60) {
for (k in 1:minutes[j]) {
date <- Sys.time()
hour(date) <- i
minute(date) <- j
query <- c(
paste0('{
"bus" : "A1",
"sourceBusStop" : "KentRidgeMRT",
"destinationBusStop" : "PGPR",
"timestamp" : {"$date": "',date,'"}}'
)
)
queries[length(queries)+1] <- query
}
}
}
for (i in 7:23) {
minutes <- c(round(rnorm(hourly[i-6], 5, 1.5)))
for (j in 1:60) {
for (k in 1:minutes[j]) {
date <- Sys.time()
hour(date) <- i
minute(date) <- j
query <- c(
paste0('{
"bus" : "A1",
"sourceBusStop" : "KentRidgeMRT",
"destinationBusStop" : "PGPR",
"timestamp" : {"$date": "',date,'"}}'
)
)
queries[length(queries)+1] <- query
}
}
}
for (i in 7:23) {
minutes <- c(round(rnorm(hourly[i-6], 5, 1.5)))
for (j in 1:60) {
for (k in 1:minutes[j]) {
date <- Sys.time()
hour(date) <- i
minute(date) <- j
query <- c(
paste0('{
"bus" : "A1",
"sourceBusStop" : "KentRidgeMRT",
"destinationBusStop" : "PGPR",
"timestamp" : {"$date": "',date,'"}}'
)
)
queries[length(queries)+1] <- query
}
print(length(queries))
}
}
queries
for (i in 7:23) {
minutes <- c(round(rnorm(hourly[i-6], 5, 1.5)))
for (j in 1:60) {
for (k in 1:minutes[j]) {
date <- Sys.time()
hour(date) <- i
minute(date) <- j
query <- c(
paste0('{
"bus" : "A1",
"sourceBusStop" : "KentRidgeMRT",
"destinationBusStop" : "PGPR",
"timestamp" : {"$date": "',date,'.772Z"}}'
)
)
queries[length(queries)+1] <- query
}
print(length(queries))
}
}
queries <- list()
for (i in 7:23) {
minutes <- c(round(rnorm(hourly[i-6], 5, 1.5)))
for (j in 1:60) {
for (k in 1:minutes[j]) {
date <- Sys.time()
hour(date) <- i
minute(date) <- j
query <- c(
paste0('{
"bus" : "A1",
"sourceBusStop" : "KentRidgeMRT",
"destinationBusStop" : "PGPR",
"timestamp" : {"$date": "',date,'.772Z"}}'
)
)
queries[length(queries)+1] <- query
}
print(length(queries))
}
}
for (i in 7:23) {
minutes <- c(round(rnorm(hourly[i-6], 5, 1.5)))
#for (j in 1:60) {
#  for (k in 1:minutes[j]) {
#    date <- Sys.time()
#   hour(date) <- i
#   minute(date) <- j
#
#    query <- c(
#      paste0('{
#            "bus" : "A1",
#             "sourceBusStop" : "KentRidgeMRT",
#             "destinationBusStop" : "PGPR",
#            "timestamp" : {"$date": "',date,'.772Z"}}'
#      )
#    )
#    queries[length(queries)+1] <- query
#  }
#  print(length(queries))
#}
print(length(minutes))
}
print(minutes)
for (i in 7:23) {
minutes <- c(round(rnorm(hourly[i-6], 5, 1.5)))
#for (j in 1:60) {
#  for (k in 1:minutes[j]) {
#    date <- Sys.time()
#   hour(date) <- i
#   minute(date) <- j
#
#    query <- c(
#      paste0('{
#            "bus" : "A1",
#             "sourceBusStop" : "KentRidgeMRT",
#             "destinationBusStop" : "PGPR",
#            "timestamp" : {"$date": "',date,'.772Z"}}'
#      )
#    )
#    queries[length(queries)+1] <- query
#  }
#  print(length(queries))
#}
print(minutes)
}
rlnorm(n, meanlog = 0, sdlog = 1)
rlnorm(200, meanlog = 0, sdlog = 1)
hist(a)
a<-rlnorm(200, meanlog = 0, sdlog = 1)
hist(a)
shiny::runApp()
mydata <- jsonlite::fromJSON("https://api.github.com/repos/jeroenooms/mongolite/issues")
mydata$created_at <- strptime(mydata$created_at, "%Y-%m-%dT%H:%M:%SZ", 'UTC')
mydata$closed_at <- strptime(mydata$closed_at, "%Y-%m-%dT%H:%M:%SZ", 'UTC')
issues <- mongo("issues")
issues
issues$insert(mydata)
issues$find(
query = '{"created_at": { "$gte" : { "$date" : "2017-01-01T00:00:00Z" }}}',
fields = '{"created_at" : true, "user.login" : true, "title":true, "_id": false}'
)
mydata
mydata[1]
mydata[1]$created_at
mydata$created_at
queryList$find()
queryList <- mongo(db = "local", collection = "queryList")
queryList$find()
runApp()
library(mc2d)
library(lubridate)
library(mongolite)
queryList <- mongo(url = "mongodb://soraares:bt3103@therouteranger-shard-00-00-rgv6u.mongodb.net:27017,therouteranger-shard-00-01-rgv6u.mongodb.net:27017,therouteranger-shard-00-02-rgv6u.mongodb.net:27017/test?ssl=true&replicaSet=TheRouteRanger-shard-0&authSource=admin", db = "trr", collection = "queryList")
set.seed(123)
hourly <- list(500,550,700,950,1000,1200,950,800,650,500,500,450,400,350,300,200,100)
queries <- list()
for (i in 7:23) {
normal <- sort(c(rnorm(60, 10, 0.075)))
normal1 <- normal[31:60]
normal2 <- normal[1:30]
normal <- c(normal1, normal2)
normal <- sapply(normal, {function(x) x = rnorm(1,x,1)})
denom <- sum(normal)
mins <- round(sapply(normal, {function(x) x = x/denom*hourly[[i-6]]}))
for (k in 1:60) {
for (l in 1:mins[[k]]) {
date <- Sys.time()
hour(date) <- i
minute(date) <- k
query <- c(
paste0('{
"bus" : "A2",
"stopId": "BIZ2",
"busIdx": "",
"realIdx": "",
"sourceBusStop" : "BIZ2",
"destinationBusStop" : "KentRidgeMRT",
"timestamp" : {"$date": "',substring(date,0,10),'T',substring(date,12,19),'.772Z"}}'
)
)
queryList$insert(query)
}
}
print(i)
}
for (k in 1:60) {
for (l in 1:mins[[k]]) {
date <- Sys.time()
hour(date) <- i
minute(date) <- k
query <- c(
paste0('{
"bus" : "A2",
"stopId": "BIZ2",
"busIdx": "",
"realIdx": "",
"sourceBusStop" : "BIZ2",
"destinationBusStop" : "KentRidgeMRT",
"timestamp" : {"$date": "',substring(date,0,10),'T',substring(date,12,19),'.772Z"}}'
)
)
queryList$insert(query)
}
}
runApp()
queryList <- mongo(db = "local", collection = "queryList")
querylist$find('{"sourceBusStop":"COM2","timestamp":{"$gte":{"$date":"2017-10-12T00:00:00Z"},"$lt":{"$date":"2017-10-13T00:00:00Z"}}}')
queryList$find('{"sourceBusStop":"COM2","timestamp":{"$gte":{"$date":"2017-10-12T00:00:00Z"},"$lt":{"$date":"2017-10-13T00:00:00Z"}}}')
a<-queryList$find('{"sourceBusStop":"COM2","timestamp":{"$gte":{"$date":"2017-10-12T00:00:00Z"},"$lt":{"$date":"2017-10-13T00:00:00Z"}}}')
boarding<-queryList$find('{"sourceBusStop":"COM2","timestamp":{"$gte":{"$date":"2017-10-12T00:00:00Z"},"$lt":{"$date":"2017-10-13T00:00:00Z"}}}')
if (timeFrame == "Hourly") {
boarding <- table(cut(boarding$timestamp, breaks="hour"))
alighting <- table(cut(alighting$timestamp, breaks="hour"))
} else if (timeFrame == "Daily") {
boarding <- table(cut(boarding$timestamp, breaks="day"))
alighting <- table(cut(alighting$timestamp, breaks="day"))
} else if (timeFrame == "Weekly") {
boarding <- table(cut(boarding$timestamp, breaks="week"))
alighting <- table(cut(alighting$timestamp, breaks="week"))
} else if (timeFrame == "Monthly") {
boarding <- table(cut(boarding$timestamp, breaks="month"))
alighting <- table(cut(alighting$timestamp, breaks="month"))
}
boarding <- table(cut(boarding$timestamp, breaks="hour"))
boarding
boarding <- data.frame(boarding)
boarding$Group <- paste0("Boarding from ", busStop)
boarding$Group <- paste0("Boarding from COM2")
colnames(boarding) <- c("timeFrame", "Count", "Group")
boarding
runApp()
14:00
as_datetime(14:00)
14:00
runApp()
a<-queryList$find()
queryList <- mongo(db = "local", collection = "queryList")
a<-queryList$find()
table(cut(a$timestamp, breaks = "Hour"))
table(cut(a$timestamp, breaks = "hour"))
runApp()
table(cut(a$timestamp, breaks = "Hour"))
a<-queryList$find()
table(cut(a$timestamp, breaks = "hour"))
table(cut(a$timestamp, breaks = "hour"))[1]
b <-data.frame(a)
b
b$timestamp
as.Date(b$timestamp)
b$timestamp[1]
typeof(b$timestamp[1])
b$timestamp[1] + 2
b$timestamp[1] + 60*60*2
runApp()
head(b$timeFrame, nrow(b)-2)
b
nrow(b)
head(b$timeFrame)
runApp()
head(b$timeFrame)
b
b$timestamp
head(b$timestamp)
head(b$timestamp, nrow(b)-2)
tail(b$timestamp,2)
tail(b$timestamp,2)+2*60*60
runApp()
tail(b$timestamp,2)+2*60*60
tail(b$timestamp,2)
tail(b$timestamp,2)+2*60*60
data.frame(tail(b$timestamp,2)+2*60*60)
rbind(b$timestamp, data.frame(tail(b$timestamp,2)+2*60*60))
runApp()
typeof(tail(b$timestamp,2))
as.integer(tail(b$timestamp,2))
runApp()
runApp()
as.Date
runApp()
shiny::runApp()
shiny::runApp()
runApp()
seq("2017-10-12","2017-10-25")
seq.Date("2017-10-12","2017-10-25")
seq.Date(as.Date("2017-10-12"),"2017-10-25")
seq.Date(as.Date("2017-10-12"),as.Date("2017-10-25"))
seq.Date(as.Date("2017-10-12"), as.Date("2017-10-25"), by = "day")
seq.Date(as.Date("2017-10-12"), as.Date("2017-10-12"), by = "hour")
queryList <- mongo(url = "mongodb://soraares:bt3103@therouteranger-shard-00-00-rgv6u.mongodb.net:27017,therouteranger-shard-00-01-rgv6u.mongodb.net:27017,therouteranger-shard-00-02-rgv6u.mongodb.net:27017/test?ssl=true&replicaSet=TheRouteRanger-shard-0&authSource=admin", db = "trr", collection = "queryList")
b<-queryList$aggregate('[{"$match": {"sourceBusStop":"COM2", "timestamp":{"$gte":{"$date":"2017-10-10T00:00:00Z"}, "$lt":{"$date":"2017-10-27T00:00:00Z"}}}}, {"$project": {"day": {"$dayOfMonth":"$timestamp"}}}, {"$group":{"_id":{"day":"$day"},"count":{"$sum":1}}}]')
b
a<-queryList$aggregate('[{"$match": {"sourceBusStop":"COM2", "timestamp":{"$gte":{"$date":"2017-10-12T00:00:00Z"}, "$lt":{"$date":"2017-10-27T00:00:00Z"}}}}, {"$project": {"hour": {"$hour":"$timestamp"}, "timestamp":1}}, {"$group":{"_id":{"hour":"$hour", "date":{"$dateToString": { "format": "%Y-%m-%d %H", "date": "$timestamp"}}},"count":{"$sum":1}}}]')
a
a[2]
a[1]
a[1][1]
a[1][2]
a[1][2,]
a[1][,1]
a[1][,1][1]
a[1][,1][2]
typeof(a[1][,1][1])
typeof(a[1][,1][2])
date<-"2017-10-26"
a[1][,1][1]
hours<-a[1][,1][1]
hours
date
hours[1]
hours[1,]
sapply(hours, {function(x) x = paste0(as.character(x), date)})
sapply(hours, {function(x) x = paste0(date, as.character(x), "00:00")})
sapply(hours, {function(x) x = paste0(date, " ", as.character(x), "00:00")})
sapply(hours, {function(x) x = paste0(date, " ", as.character(x), ":00:00")})
runApp()
a
typeof(a)
b<-data.frame(a)
hours<-a[1][,1][1]
hours
sapply(hours, {function(x) x = paste0(date, " ", as.character(x), ":00:00")})
b<-queryList$aggregate('[{"$match": {"sourceBusStop":"COM2", "timestamp":{"$gte":{"$date":"2017-10-10T00:00:00Z"}, "$lt":{"$date":"2017-10-27T00:00:00Z"}}}}, {"$project": {"day": {"$dayOfMonth":"$timestamp"}}}, {"$group":{"_id":{"day":"$day"},"count":{"$sum":1}}}]')
hours<-b[1][,1][1]
b
hours
sapply(hours, {function(x) x = paste0(date, " ", as.character(x), ":00:00")})
a
a<-queryList$aggregate('[{"$match": {"sourceBusStop":"COM2", "timestamp":{"$gte":{"$date":"2017-10-12T00:00:00Z"}, "$lt":{"$date":"2017-10-27T00:00:00Z"}}}}, {"$project": {"hour": {"$hour":"$timestamp"}, "timestamp":1}}, {"$group":{"_id":{"hour":"$hour"},"count":{"$sum":1}}}]')
a
timeFrame <- boarding[1][,1][1]
boarding<-a
timeFrame <- boarding[1][,1][1]
timeFrame
boarding[1][,1][2]
boarding[1][,2][1]
boarding[1][,1]
boarding[1]
boarding[2]
typeof(boarding[2])
count<-boarding[2]
timeFrame
count
boardin[1]
boarding[1]
typeof(boarding[1])
data.frame(boarding)
data.frame(boarding)[,1]
typeof(data.frame(boarding)[,1])
runApp()
runApp()
a<-queryList$aggregate('[{"$match": {"sourceBusStop":"COM2", "timestamp":{"$gte":{"$date":"2017-10-12T00:00:00Z"}, "$lt":{"$date":"2017-10-27T00:00:00Z"}}}}, {"$project": {"hour": {"$hour":"$timestamp"}, "timestamp":1}}, {"$group":{"_id":{"hour":"$hour"},"count":{"$sum":1}}}]')
a
runApp()
runApp()
runApp()
length("11")
size("11")
runApp()
